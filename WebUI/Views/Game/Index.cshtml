@model IEnumerable<NR155910155992.MemoGame.WebUI.Models.CardViewModel>

@{
    ViewData["Title"] = "Game";
    int cols = (int?)TempData.Peek("Cols") ?? 2;
	int rows = (int?)TempData.Peek("Rows") ?? 2;
}

<div class="game-container">
    <div class="game-header">
        <h1>Current Game</h1>
        <div id="timer" style="font-size: 1.5em; font-weight: bold;">00:00</div>
    </div>

    <div class="game-board" style="grid-template-columns: repeat(@cols, 1fr); grid-template-rows: repeat(@rows, 1fr);">
        @foreach (var card in Model)
        {
            bool isFaceUp = card.IsRevealed || card.IsMatched;
            string flippedClass = isFaceUp ? "is-flipped" : "";

            string displayStyle = isFaceUp ? "display:block;" : "display:none;";

            string clickAction = card.IsMatched ? "" : $"flipCard(this, {card.Row}, {card.Col})";
            string cursorStyle = card.IsMatched ? "cursor: default;" : "cursor: pointer;";

            string imgSource = "";
            if (isFaceUp)
            {
               imgSource = Url.Action("GetImage", "CardItems", new { id = card.Id }) ?? "Assets/Cards/missing_image.png";
            }

            <div class="card-scene" style="@cursorStyle" onclick="@clickAction">
                <div class="card-object @flippedClass" id="card-@card.Row-@card.Col">

                    <div class="face front">
                        <img src="@Url.Content("~/Assets/Cards/card_backside.png")" alt="Back" />
                    </div>
                    <div class="face back">
                        <img id="img-@card.Row-@card.Col"
                             src="@imgSource"
                             alt="Revealed"
                             style="@displayStyle" />
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/board.scss" asp-append-version="true" />
}

<script src="~/js/board.js" asp-append-version="true"></script>